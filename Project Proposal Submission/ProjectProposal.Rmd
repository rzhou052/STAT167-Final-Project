---
title: "Project Proposal"
authors: "Richard Zhou, Adam Rui, Jonathan Darius, Ojasvi Godha, Ryan Huang, Isaac Kang"
output: html_document
---

## Installation and Packages

```{r}
# install.packages("tidyverse")
# install.packages("nycflights13")
# install.packages("nycflights23")

library("tidyverse")
library("nycflights13")
library("nycflights23")
library("dplyr")
```

## Objectives:

Our overall objective of this project is to analyze and compare flight data from 2013 and 2023 using the nycflights13 and nycflights23 packages. We aim to identify patterns, trends, and key factors affecting flight performance, delays, and operations over time. Our research aims to answer the following questions:

1.   Have flight delays improved or gotten worse between 2013 and 2023?

2.  To expand on Question #1, have individual airlines gotten better or worse with delays over time?

3.  How does weather impact flight performance, and has it changed over time?

4.  Which airports have seen the largest increase or decrease in traffic?

5.  Have there been any big changes in popular destinations from NYC between 2013 and 2023?

6.  Is there a seasonal pattern to flight delays? (Such as holidays)

7.  What are the most reliable airlines, and has this changed over time?

## Datasets:

[Include your exploratory data analysis and some visualization! Make sure the data is reasonably clean and contains enough information to answer your questions. Which variables in the table are most relevant to your questions? Do you plan to acquire additional datasets?]\
\
We plan on using the packages nycflights13 and nycflights23, using the datasets provided in both. Specifically, we will be focusing on flights, airlines, airports, and weather from both packages.

```{r}
# listing dimensions of datasets
dimensions <- tibble(name = character(), rows = integer(), cols = integer())

dimensions <- add_row(dimensions, name = "flights_2013", rows = nrow(nycflights13::flights), cols = ncol(nycflights13::flights))
dimensions <- add_row(dimensions, name = "flights_2023", rows = nrow(nycflights23::flights), cols = ncol(nycflights23::flights))

dimensions <- add_row(dimensions, name = "airlines_2013", rows = nrow(nycflights13::airlines), cols = ncol(nycflights13::airlines))
dimensions <- add_row(dimensions, name = "airlines_2023", rows = nrow(nycflights23::airlines), cols = ncol(nycflights23::airlines))

dimensions <- add_row(dimensions, name = "airports_2013", rows = nrow(nycflights13::airports), cols = ncol(nycflights13::airports))
dimensions <- add_row(dimensions, name = "airports_2023", rows = nrow(nycflights23::airports), cols = ncol(nycflights23::airports))

dimensions <- add_row(dimensions, name = "weather_2013", rows = nrow(nycflights13::weather), cols = ncol(nycflights13::weather))
dimensions <- add_row(dimensions, name = "weather_2023", rows = nrow(nycflights23::weather), cols = ncol(nycflights23::weather))

print(dimensions)
```
```{r}
flights_combined <- bind_rows(nycflights13::flights %>% mutate(year = 2013), nycflights23::flights %>% mutate(year = 2023))

flights_clean <- flights_combined %>%
  filter(!is.na(dep_delay), !is.na(arr_delay)) %>%
  left_join(nycflights13::airlines, by = "carrier") %>%
  left_join(nycflights13::airports, by = c("dest" = "faa"))
```


# Preliminary Data Analysis

# 1. General Summary of Departure Delays
```{r}
dep_delay_summary <- flights_clean %>%
  group_by(year) %>%
  summarise(
    avg_dep_delay = mean(dep_delay, na.rm = TRUE),
    median_dep_delay = median(dep_delay, na.rm = TRUE),
    perc_flights_delayed = mean(dep_delay > 15) * 100
  )

print(dep_delay_summary)
```

- This table shows the average and median departure delays for 2013 and 2023, along with the percentage of flights delayed by more than 15 minutes. It gives an initial view if flight punctuality has improved or worsened over time.

# 2. Summary of Arrival Delays
```{r}
arr_delay_summary <- flights_clean %>%
  group_by(year) %>%
  summarise(
    avg_arr_delay = mean(arr_delay, na.rm = TRUE),
    median_arr_delay = median(arr_delay, na.rm = TRUE),
    perc_arrivals_delayed = mean(arr_delay > 15) * 100
  )

print(arr_delay_summary)
```

- This summary focuses on arrival delays, calculating similar statistics to departure delays. It helps us check whether late departures also result in late arrivals and if arrival performance changed between 2013 and 2023.

# 3. Number of flights per airport
```{r}
airport_traffic <- flights_clean %>%
  group_by(origin, year) %>%
  summarise(num_flights = n(), .groups = 'drop')

ggplot(airport_traffic, aes(x = origin, y = num_flights, fill = factor(year))) +
  geom_col(position = "dodge") +
  labs(title = "Number of Flights per NYC Airport (2013 vs 2023)", x = "Airport", y = "Number of Flights", fill = "Year")
```

- This plot compares the total number of flights at each major NYC airport (JFK, LGA, EWR) between 2013 and 2023. It highlights if traffic increased or decreased at certain airports, helping answer which airports saw the biggest changes.

# 4. Seasonality of Delays
```{r}
flights_clean %>%
  mutate(month = month(time_hour, label = TRUE)) %>%
  group_by(month, year) %>%
  summarise(avg_dep_delay = mean(dep_delay), .groups = 'drop') %>%
  ggplot(aes(x = month, y = avg_dep_delay, group = year, color = factor(year))) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(title = "Seasonal Pattern of Departure Delays", x = "Month", y = "Avg Departure Delay (mins)", color = "Year")
```
- This line chart shows how departure delays vary across months for both years. Peaks in certain months could point to holiday seasons, weather events, or seasonal congestion affecting flight performance.

# 5. Weather Impact Check
```{r}
flights_weather %>%
  mutate(high_precip = precip > 0.1) %>%
  group_by(high_precip) %>%
  summarise(avg_dep_delay = mean(dep_delay, na.rm = TRUE)) %>%
  print()
```

- Here, we compare the average departure delay between flights with high precipitation (rain, snow, etc.) and those with little to no precipitation. It gives quick insight into how weather affects flight delays.

# 6. Most Reliable Airlines (lowest average departure delay)
```{r}
reliable_airlines <- flights_clean %>%
  group_by(name.x, year) %>%
  summarise(avg_dep_delay = mean(dep_delay, na.rm = TRUE), .groups = 'drop') %>%
  arrange(avg_dep_delay)

print(reliable_airlines %>% group_by(year) %>% slice_head(n = 5))  # Top 5 for each year
```

- This table lists the top 5 airlines with the lowest average departure delays for each year. It helps identify the most reliable carriers in 2013 and 2023, and see if rankings shifted over the decade.



Exploring flight delay over time based on carrier:


```{r}
delay_by_carrier <- flights_clean %>%
  group_by(name.x, year) %>%
  summarise(avg_dep_delay = mean(dep_delay), .groups = 'drop')

ggplot(delay_by_carrier, aes(x = name.x, y = avg_dep_delay, fill = factor(year))) +
  geom_col(position = position_dodge2(width = 0.8, preserve = "single")) +
  coord_flip() +
  labs(title = "Average Departure Delay by Carrier (2013 vs. 2023)", x = "Airline", y = "Avg Delay (mins)", fill = "Year")
```

Exploring how weather has impacted flight times:

```{r}
flights_weather <- bind_rows((nycflights13::flights %>% left_join(nycflights13::weather, by = c("origin", "time_hour"))), (nycflights23::flights %>% left_join(nycflights23::weather, by = c("origin", "time_hour"))))

flights_weather %>%
  ggplot(aes(x = precip, y = dep_delay)) +
  geom_point(alpha = 0.2) +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "Departure Delays vs Precipitation", x = "Precipitation (inches)", y = "Delay (mins)")
```

## Our Plan:

[What do you plan to do with the data to answer your questions? For example, what assumptions will you make? What plots will you generate? What models will you explore? What evaluation approaches will you use? Some preliminary data analysis and modeling results will be a plus, but not a must.]

## Alternative Strategies/Backup Plans:

In the case our initial objectives don't work out as planned, here are a couple of alternative questions we came up with: 

1. Are there certain aircrafts or tail numbers that seem to be more prone to delays? 
    - We can analyze the delay times reported for each flight and see if there is a noticable pattern between the delay times and the types of aircrafts or tail numbers. 

2. Does the data support the idea that an aircraft with more flights per day tend to experience more delays due to the tight scheduling? 
    - We would look at aircrafts that are listed for multiple flights in a single day and see if the reported delay times are significant enough to prove that there is a reasonable relation between number of flights per day and flight delays. 
